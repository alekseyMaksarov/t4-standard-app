{% extends 'Admin/Blank.html' %}

{% block breadcrumbs %}
<ol class="breadcrumb">
    <li><a href="/admin/">Админ-панель</a></li>
    <li><a href="/admin/news/">Новости</a></li>
    <li>Рубрики</li>
</ol>
{% endblock %}

{% block toolbar %}
<a class="btn btn-primary" href="/admin/news/editTopic?id=new"><i class="glyphicon glyphicon-plus-sign"></i> Добавить рубрику</a>
{% endblock %}


{% block header %}
Рубрики новостей
{% endblock %}

{% block content %}

<div class="row">
    {% set level = items[0].__lvl %}
    {% set count = 0 %}
    {% if items.count %}
    <ul class="list-unstyled list-sortable">

        {% for key, item in items %}

        {% set current = item.__lvl %}
        {% if current == level %}
        {% if count > 0 %}</li>{% endif %}
        {% endif %}

        {% if current > level %}
        <ul class="list-unstyled list-sortable" style="margin-left: 20px;">
        {% set level = current %}
        {% endif %}

        {% if current < level %}
        {{"</li></ul>"|repeat(level-current)|raw}}</li>
        {% set level = current %}
        {% endif %}

        <li data-id="{{item.Pk}}">
                <div class="list-group-item">
                    <button type="button" class="btn btn-default btn-sm list-sortable-handle" data-id="{{item.Pk}}"><i class="glyphicon glyphicon-resize-vertical"></i></button>&nbsp;&nbsp;
                    {{item.title}}
                    <p class="pull-right">
                        {% if item.hasPrevSibling %}
                        <a class="btn btn-info btn-sm" href="/admin/news/topicUp/?id={{item.Pk}}"><i class="glyphicon glyphicon-arrow-up"></i></a>
                        {% else %}
                        <button class="btn btn-default btn-sm"><i class="glyphicon glyphicon-option-horizontal"></i></button>
                        {% endif %}
                        {% if item.hasNextSibling %}
                        <a class="btn btn-info btn-sm" href="/admin/news/topicDown/?id={{item.Pk}}"><i class="glyphicon glyphicon-arrow-down"></i></a>
                        {% else %}
                        <button class="btn btn-default btn-sm"><i class="glyphicon glyphicon-option-horizontal"></i></button>
                        {% endif %}
                        &nbsp;&nbsp;
                        <a class="btn btn-primary btn-sm" href="/admin/news/editTopic/?id={{item.Pk}}"><i class="glyphicon glyphicon-edit"></i></a>
                        <a class="btn btn-danger btn-sm" href="/admin/news/deleteTopic/?id={{item.Pk}}" class="confirmable"><i class="glyphicon glyphicon-remove"></i></a>
                    </p>
                </div>

        {% set count = count + 1 %}

        {% endfor %}
        {{"</li></ul>"|repeat(current)|raw}}</li>
    </ul>
    {% endif %}
</div>

{% endblock %}

{% block pagescript %}
<script type="text/javascript">
    $(function() {
        $('a.confirmable').click(function() {
            return confirm('Вы уверены?');
        });

        $('.list-sortable').sortable({
            handle: ".list-sortable-handle",
            axis: "y",
            placeholder: "ui-state-highlight",
            update: function( event, ui ) {
                alert('!!!');
                /*
                 var prevSibling = ui.item.prev();
                 var nextSibling = ui.item.next()
                 if (!$.isEmptyObject(prevSibling) && undefined != prevSibling.attr('data-id')) {
                 var url = '/admin/pages/moveAfter.json';
                 var siblingId = prevSibling.attr('data-id');
                 } else {
                 var url = '/admin/pages/moveBefore.json';
                 var siblingId = nextSibling.attr('data-id');
                 }
                 $.post(url, {id: ui.item.attr('data-id') ,to: siblingId}, function (r) {
                 if (!r.result) {
                 alert('ERROR!!!');
                 }
                 });
                 */
            }
        });
    });
</script>
{% endblock %}